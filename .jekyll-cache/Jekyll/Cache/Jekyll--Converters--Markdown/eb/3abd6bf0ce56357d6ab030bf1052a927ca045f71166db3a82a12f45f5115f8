I"ì<p>Today I probably did the rehearsal for my end-term defense (still to tired to believe this shit through). And EVENTUALLY I can start to study and to build the quantitative trading and system. But, after knowing a bit of this work, I convince myself and start the big shit from now on.</p>

<p>Thereby the first try is to prepare(crawling) the data for the traiiiiiiiiiiiiiiiiiiiiining, yup it is a long way to run.</p>

<p>So, the best thing of in this moment is that you can find approximately everything on Google. Thankfully, I quickly found a <a href="https://www.youtube.com/watch?v=IqrFMiJfHBU">tutorial</a> (In Chinese). This is suit to me because I need to crawling the stock information from the <a href="http://www.twse.com.tw/zh/">Taiwan Stock Exchange Corporation</a> as well.</p>

<p>Then, after I code the same as what he coded in the video, I got a <em>UnicodeEncodeError</em>. 
The original code:</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">csv</span>

<span class="n">url</span> <span class="o">=</span> <span class="s">'website_url'</span>
<span class="n">res</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
<span class="n">s</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
<span class="nb">dir</span> <span class="o">=</span> <span class="s">'./directory/'</span>

<span class="n">outputfile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="nb">dir</span><span class="p">,</span> <span class="s">'w'</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="s">''</span><span class="p">)</span>
<span class="n">outputwriter</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">writer</span><span class="p">(</span><span class="n">outputfile</span><span class="p">)</span>
<span class="n">outputwriter</span><span class="o">.</span><span class="n">writerow</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="s">'fields'</span><span class="p">])</span>
<span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="s">'data'</span><span class="p">]):</span>
	<span class="n">outputwriter</span><span class="o">.</span><span class="n">writerow</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
	<span class="k">pass</span>
<span class="n">outputfile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div></div>

<table>
  <tbody>
    <tr>
      <td>Then this error popped up</td>
      <td>UnicodeEncodeError: â€˜asciiâ€™ codec canâ€™t encode character â€˜\u5e74â€™ in position 6: ordinal not in range(128)</td>
    </tr>
  </tbody>
</table>

<p>This dirty bug points to the <strong>outputwriter.writerow(s[â€˜titleâ€™])</strong>. Seems like the character in the <strong>s[â€˜titleâ€™]</strong> cannot be encoded and written into .csv file due to the wrong codec. So I checked the my encoding setting of IDE(PyCharm), and it is the UTF-8. (Wait? I definitely select UTF-8, whatâ€™s the matter to ASCII?).</p>

<p>Fortunately, a solution in stackoverflow gives an explanation and I modify the code by simply adding <em>â€˜utf-8â€™</em> in open():</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="s">'w'</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s">'utf-8'</span><span class="p">,</span>  <span class="n">newline</span><span class="o">=</span><span class="s">''</span><span class="p">)</span> <span class="k">as</span> <span class="nb">file</span><span class="p">:</span>
    <span class="n">out_writer</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">writer</span><span class="p">(</span><span class="nb">file</span><span class="p">)</span>
    <span class="n">out_writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="s">'fields'</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="s">'data'</span><span class="p">]):</span>
        <span class="n">out_writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">pass</span>
    <span class="k">pass</span>
<span class="nb">file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div></div>
<p>And it works.</p>

<p>However, thereâ€™s one thing Iâ€™m really curious is <strong>Why I already select the UTF-8 encoding in PyCharms, but the csv function still use ASCII to encode it?</strong></p>

<p>Perhaps a mystery.</p>

<h3 id="learned-today"><em>Learned Today</em></h3>
<ul>
  <li>Be aware of your codec setting</li>
  <li>Never trust your IDE ðŸ˜‚</li>
</ul>
:ET